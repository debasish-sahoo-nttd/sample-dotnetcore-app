
steps:
  - task: AzureCLI@2
    displayName: Get AKS credentials
    env:
      KUBECONFIG: "$(Pipeline.Workspace)/kubeconfig"
    inputs:
      azureSubscription: $(serviceConnection)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        # the variables are passed in from the pipeline UI
        az aks get-credentials --resource-group $(aksResourceGroup) --name $(aksCluster) --overwrite-existing
        kubelogin convert-kubeconfig -l azurecli
        kubectl get nodes || exit 1
      addSpnToEnvironment: true